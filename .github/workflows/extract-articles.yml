name: Extract Articles

on:
  workflow_call: {}

jobs:
  execute:
    name: üï∑Ô∏è Execute
    runs-on: ubuntu-latest
    strategy:
      matrix:
        range:
          - { from: 0,    to: 200  }
          - { from: 200,  to: 400  }
          - { from: 400,  to: 600  }
          - { from: 600,  to: 800  }
          - { from: 800,  to: 1000 }
          - { from: 1000, to: 1200 }
          - { from: 1200, to: 1400 }
          - { from: 1400, to: 1600 }
          - { from: 1600, to: 1800 }
          - { from: 1800, to: 2000 }
          - { from: 2000, to: 2200 }
          - { from: 2200, to: 2400 }
          - { from: 2400, to: 2600 }
          - { from: 2600, to: 2800 }
          - { from: 2800, to: 2859 }
    steps:
      - name: üõë Cancel Previous Runs
        uses: styfle/cancel-workflow-action@0.9.1

      - name: ‚¨áÔ∏è Checkout repo
        uses: actions/checkout@v3

      - name: ‚éî Setup node
        uses: denoland/setup-deno@v1

      - name: üöÄ Execute
        env:
          SUPABASE_API_KEY: ${{ env.SUPABASE_API_KEY }}
          SUPABASE_URL: ${{ env.SUPABASE_URL }}
        run: |
          deno run --allow-all crawler/job.ts \
            --href="https://ithelp.ithome.com.tw/articles?tab=ironman" \
            --from="${{ matrix.range.from }}" \
            --to="${{ matrix.range.to }}"

